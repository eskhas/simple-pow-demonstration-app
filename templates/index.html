<!DOCTYPE html>
<html>
<head>
    <title>Proof of Work Blockchain </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .block { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .miner { margin-bottom: 10px; }
        .stats { margin-top: 20px; }
    </style>
    <script>
        function startMining() {
            fetch('/start', { method: 'POST' })
                .then(response => response.json())
                .then(data => alert('Mining started: ' + JSON.stringify(data)))
                .catch(error => alert('Error: ' + error));
        }

        function adjustDifficulty() {
            const newDifficulty = prompt("Enter new difficulty level:");
            if (newDifficulty) {
                fetch('/difficulty', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ difficulty: parseInt(newDifficulty) })
                }).then(response => {
                    if (response.ok) {
                        alert('Difficulty updated!');
                        location.reload();
                    } else {
                        alert('Failed to update difficulty.');
                    }
                });
            }
        }
        setInterval(() => {
            fetch('/')
                .then(response => response.text())
                .then(html => {
                    document.body.innerHTML = html;
                });
        }, 5000); // Refresh every 5 seconds
        
        function refreshPage() {
            location.reload();
        }
    </script>
</head>
<body>
    <h1>Proof of Work Blockchain</h1>

    <button onclick="startMining()">Start Mining</button>
    <button onclick="adjustDifficulty()">Adjust Difficulty</button>
    <button onclick="refreshPage()">Refresh</button>

    <h2>Blockchain</h2>
    <div id="blockchain">
        {% for block in blockchain %}
        <div class="block">
            <p><strong>Index:</strong> {{ block.index }}</p>
            <p><strong>Transactions:</strong> {{ block.transactions }}</p>
            <p><strong>Previous Hash:</strong> {{ block.previous_hash }}</p>
            <p><strong>Hash:</strong> {{ block.hash }}</p>
            <p><strong>Nonce:</strong> {{ block.nonce }}</p>
        </div>
        {% endfor %}
    </div>

    <h2>Mining Rewards</h2>
    <div id="miners">
        {% for miner, reward in rewards.items() %}
        <div class="miner">
            <p><strong>Miner:</strong> {{ miner }}</p>
            <p><strong>Reward:</strong> {{ reward }}</p>
            <p><strong>Status:</strong> {{ status[miner].status }}</p>
            <p><strong>Last Mining Time:</strong> {{ status[miner].time }} seconds</p>
        </div>
        {% endfor %}
    </div>

    <h2>Statistics</h2>
    <div class="stats">
        <p><strong>Total Blocks:</strong> {{ total_blocks }}</p>
        <p><strong>Total Rewards Distributed:</strong> {{ total_rewards }}</p>
        <p><strong>Average Mining Time:</strong> {{ avg_mining_time }} seconds</p>
    </div>
</body>
</html>
